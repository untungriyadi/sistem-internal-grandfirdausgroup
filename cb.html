<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Siteplan Interaktif â€” Grand Firdaus</title>
    <style>
        :root {
            --bg: #f6f8fb;
            --panel: #ffffff;
            --accent: #2563eb;
            --muted: #6b7280
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial
        }

        .app {
            display: flex;
            gap: 16px;
            height: 100vh;
            padding: 16px;
            background: linear-gradient(180deg, #eef2ff 0%, var(--bg) 100%)
        }

        .left {
            flex: 1;
            min-width: 300px;
            background: var(--panel);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 6px 18px rgba(16, 24, 40, 0.06);
            display: flex;
            flex-direction: column
        }

        .controls {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap
        }

        .btn {
            background: transparent;
            border: 1px solid #e6e9ef;
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600
        }

        .btn.primary {
            background: var(--accent);
            color: #fff;
            border-color: transparent
        }

        .viewer {
            flex: 1;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
            display: grid;
            grid-template-columns: 1fr
        }

        .svgwrap {
            width: 100%;
            height: 100%;
            touch-action: none;
            background: linear-gradient(180deg, #fff, #fbfdff)
        }

        .sidebar {
            width: 360px;
            max-width: 40%;
            background: var(--panel);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 6px 18px rgba(16, 24, 40, 0.06);
            display: flex;
            flex-direction: column
        }

        .card {
            background: linear-gradient(180deg, #fff, #fbfdff);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px
        }

        .chip {
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid #e6e9ef;
            font-size: 13px
        }

        .search {
            display: flex;
            gap: 8px;
            align-items: center
        }

        input.search-input {
            flex: 1;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #e6e9ef
        }

        .info {
            font-size: 14px;
            color: var(--muted)
        }

        /* tooltip */
        .tooltip {
            position: fixed;
            pointer-events: none;
            padding: 8px 10px;
            background: #111827;
            color: #fff;
            border-radius: 8px;
            font-size: 13px;
            z-index: 40;
            transform: translate(-50%, -120%);
            white-space: nowrap
        }

        /* modal */
        .modal {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 50;
            background: #fff;
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(2, 6, 23, 0.12);
            min-width: 220px
        }

        .mini {
            font-size: 13px;
            color: var(--muted)
        }

        @media (max-width:900px) {
            .app {
                flex-direction: column
            }

            .sidebar {
                width: 100%;
                max-width: none
            }
        }
    </style>
</head>

<body>
    <div class="app">
        <div class="left">
            <div class="controls">
                <button class="btn" id="zoomOut">-</button>
                <button class="btn primary" id="resetZoom">Reset</button>
                <button class="btn" id="zoomIn">+</button>
                <button class="btn" id="fit">Fit</button>
                <button class="btn" id="toggleLabels">Toggle Labels</button>
                <div style="flex:1"></div>
                <div class="search">
                    <input id="search" class="search-input" placeholder="Cari blok / nomor (misal: B1-01)" />
                    <button class="btn" id="searchBtn">Cari</button>
                </div>
            </div>

            <div class="viewer card">
                <div id="svgWrap" class="svgwrap"></div>
            </div>

        </div>

        <aside class="sidebar">
            <div class="card">
                <h3 style="margin:0 0 6px 0">Info Blok</h3>
                <div id="infoPlaceholder" class="info">Klik sebuah blok pada siteplan untuk melihat detail di sini.
                </div>
            </div>

            <div class="card">
                <h4 style="margin:0 0 8px 0">Legenda</h4>
                <div class="legend">
                    <div class="chip">Rumah Subsidi</div>
                    <div class="chip">Rumah Tipe A</div>
                    <div class="chip">Ruang Terbuka</div>
                    <div class="chip">Fasilitas</div>
                </div>
            </div>

            <div class="card" style="flex:1;overflow:auto">
                <h4 style="margin:0 0 8px 0">Daftar Blok</h4>
                <div id="blockList" style="display:flex;flex-direction:column;gap:6px"></div>
            </div>

            <div class="card mini">
                Tips: Gunakan scroll untuk zoom, drag untuk memindahkan. Cari dengan kode blok untuk menyorot.
            </div>
        </aside>
    </div>

    <div id="tooltip" class="tooltip" style="display:none"></div>
    <div id="modal" class="modal" style="display:none"></div>

    <script>
        // --- BASIC INTERACTIVE SVG VIEWER ---
        (async function () {
            const wrap = document.getElementById('svgWrap');
            const tooltip = document.getElementById('tooltip');
            const modal = document.getElementById('modal');
            const info = document.getElementById('infoPlaceholder');
            const blockList = document.getElementById('blockList');

            // try to fetch the SVG file placed alongside this HTML. Adjust path if needed.
            const svgPath = '/mnt/data/siteplan-gfa.svg';
            let svgText = '';
            try { const res = await fetch(svgPath); svgText = await res.text(); }
            catch (e) { svgText = '<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><rect width="100%" height="100%" fill="#f3f4f6"/></svg>'; console.warn('Gagal memuat SVG, menampilkan placeholder', e); }

            // inject SVG into wrapper
            wrap.innerHTML = svgText;
            const svg = wrap.querySelector('svg');
            if (!svg) return;
            svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            svg.style.width = '100%'; svg.style.height = '100%';

            // collect candidate selectable elements: elements with id or data-name or class contains "blok" or "plot"
            const candidates = Array.from(svg.querySelectorAll('*')).filter(el => {
                if (!(el instanceof SVGElement)) return false;
                const id = el.id || '';
                const cls = el.getAttribute('class') || '';
                const data = el.getAttribute('data-name') || '';
                // prefer shapes (path, rect, polygon, g)
                const tag = el.tagName.toLowerCase();
                if (!['path', 'rect', 'polygon', 'g', 'circle', 'ellipse'].includes(tag)) return false;
                if (id || cls || data) return true;
                return false;
            });

            // sanitize and build list of blocks
            const blocks = [];
            candidates.forEach(el => {
                const id = el.id || el.getAttribute('data-name') || el.getAttribute('class') || 'blok-' + blocks.length;
                const label = id;
                const bbox = el.getBBox ? el.getBBox() : null;
                blocks.push({ id, label, el, bbox });
            });

            // style hover and selected
            const HOVER_STYLE = { stroke: '#111827', strokeWidth: 2 };
            const SELECT_STYLE = { fill: '#fde68a', stroke: '#92400e', strokeWidth: 2 };

            function setStyle(el, style) {
                if (!el) return;
                if (style.fill) el.setAttribute('data-old-fill', el.getAttribute('fill') || ''); el.setAttribute('fill', style.fill);
                if (style.stroke) el.setAttribute('data-old-stroke', el.getAttribute('stroke') || ''); el.setAttribute('stroke', style.stroke);
                if (style.strokeWidth) el.setAttribute('data-old-stroke-width', el.getAttribute('stroke-width') || ''); el.setAttribute('stroke-width', style.strokeWidth);
            }
            function resetStyle(el) {
                if (!el) return;
                const of = el.getAttribute('data-old-fill'); if (of !== null) el.setAttribute('fill', of);
                const os = el.getAttribute('data-old-stroke'); if (os !== null) el.setAttribute('stroke', os);
                const ow = el.getAttribute('data-old-stroke-width'); if (ow !== null) el.setAttribute('stroke-width', ow);
            }

            // populate block list in sidebar
            blocks.forEach(b => {
                const btn = document.createElement('button');
                btn.className = 'btn'; btn.style.textAlign = 'left'; btn.textContent = b.label;
                btn.addEventListener('click', () => { focusBlock(b); showInfo(b); });
                blockList.appendChild(btn);
            });

            // hover handlers show tooltip
            blocks.forEach(b => {
                const el = b.el;
                el.style.cursor = 'pointer';
                el.addEventListener('mouseenter', (ev) => {
                    setStyle(el, HOVER_STYLE);
                    tooltip.style.display = 'block';
                    tooltip.textContent = b.label;
                    positionTooltip(ev.clientX, ev.clientY);
                });
                el.addEventListener('mousemove', (ev) => positionTooltip(ev.clientX, ev.clientY));
                el.addEventListener('mouseleave', () => { resetStyle(el); tooltip.style.display = 'none'; });
                el.addEventListener('click', (ev) => { ev.stopPropagation(); selectBlock(b); showModal(b); showInfo(b); });
            });

            function positionTooltip(x, y) { tooltip.style.left = x + 'px'; tooltip.style.top = y + 'px'; }

            // selection
            let current = null;
            function selectBlock(b) { if (current) resetStyle(current.el); current = b; setStyle(b.el, SELECT_STYLE); }
            function showInfo(b) { info.innerHTML = `<strong>${escapeHtml(b.label)}</strong><div class='mini'>Koordinat bbox: ${b.bbox ? Math.round(b.bbox.x) + ',' + Math.round(b.bbox.y) : 'n/a'}</div>`; }
            function showModal(b) { modal.style.display = 'block'; modal.innerHTML = `<strong>${escapeHtml(b.label)}</strong><div class='mini' style='margin-top:6px'>Detail: contoh data. Ubah script untuk menautkan data nyata.</div>`; }
            document.body.addEventListener('click', () => { modal.style.display = 'none'; if (current) { resetStyle(current.el); current = null; } });

            function escapeHtml(s) { return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

            // SEARCH + focus
            const searchInput = document.getElementById('search');
            document.getElementById('searchBtn').addEventListener('click', () => {
                const q = (searchInput.value || '').trim().toLowerCase(); if (!q) return;
                const found = blocks.find(b => b.label.toLowerCase().includes(q));
                if (found) { focusBlock(found); selectBlock(found); showInfo(found); }
                else alert('Blok tidak ditemukan: ' + q);
            });

            // zoom & pan
            let viewBox = svg.viewBox && svg.viewBox.baseVal ? svg.viewBox.baseVal : { x: 0, y: 0, width: svg.clientWidth || 800, height: svg.clientHeight || 600 };
            if (!svg.getAttribute('viewBox')) svg.setAttribute('viewBox', `0 0 ${svg.clientWidth || 800} ${svg.clientHeight || 600}`);

            let isPanning = false, startX = 0, startY = 0, vb = svg.viewBox.baseVal;
            wrap.addEventListener('wheel', (e) => { e.preventDefault(); const k = Math.sign(e.deltaY); zoomAt(k > 0 ? 1.1 : 0.9, e.offsetX, e.offsetY); });
            wrap.addEventListener('mousedown', (e) => { isPanning = true; startX = e.clientX; startY = e.clientY; wrap.style.cursor = 'grabbing'; });
            window.addEventListener('mouseup', () => { isPanning = false; wrap.style.cursor = 'default'; });
            window.addEventListener('mousemove', (e) => { if (!isPanning) return; const dx = (e.clientX - startX) * (vb.width / wrap.clientWidth); const dy = (e.clientY - startY) * (vb.height / wrap.clientHeight); vb.x -= dx; vb.y -= dy; startX = e.clientX; startY = e.clientY; });

            function zoomAt(scale, cx, cy) { // scale <1 zoom in, >1 zoom out
                const rect = wrap.getBoundingClientRect(); const x = (cx / rect.width) * vb.width + vb.x; const y = (cy / rect.height) * vb.height + vb.y; const newW = vb.width * scale; const newH = vb.height * scale; vb.x = x - (x - vb.x) * (newW / vb.width); vb.y = y - (y - vb.y) * (newH / vb.height); vb.width = newW; vb.height = newH;
            }

            document.getElementById('zoomIn').addEventListener('click', () => { zoomAt(0.8, wrap.clientWidth / 2, wrap.clientHeight / 2); });
            document.getElementById('zoomOut').addEventListener('click', () => { zoomAt(1.25, wrap.clientWidth / 2, wrap.clientHeight / 2); });
            document.getElementById('resetZoom').addEventListener('click', () => { svg.setAttribute('viewBox', `0 0 ${svg.clientWidth || 800} ${svg.clientHeight || 600}`); vb = svg.viewBox.baseVal; });
            document.getElementById('fit').addEventListener('click', () => { fitToView(); });

            function fitToView() { // fit all content
                const bb = svg.getBBox(); svg.setAttribute('viewBox', `${bb.x - 20} ${bb.y - 20} ${bb.width + 40} ${bb.height + 40}`); vb = svg.viewBox.baseVal;
            }
            fitToView();

            // toggle labels: try to find <text> elements inside svg
            let labelsVisible = true;
            document.getElementById('toggleLabels').addEventListener('click', () => {
                labelsVisible = !labelsVisible; svg.querySelectorAll('text').forEach(t => t.style.display = labelsVisible ? 'inline' : 'none');
            });

            function focusBlock(b) { if (!b.bbox) return; const pad = 40; svg.setAttribute('viewBox', `${b.bbox.x - pad} ${b.bbox.y - pad} ${b.bbox.width + pad * 2} ${b.bbox.height + pad * 2}`); vb = svg.viewBox.baseVal; }

            // initial: hide tooltip on mobile tap
            wrap.addEventListener('touchstart', () => tooltip.style.display = 'none');

        })();
    </script>
</body>

</html>